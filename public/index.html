<html ng-app="TOR-Interactive">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link href="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"
        integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg=="
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.8.0/angular.min.js"></script>
    <script>
        var apiUrl = 'http://193.171.203.63/'
        var isInUserMode = false;
        var selectedBox;
        var torApp = angular.module('TOR-Interactive', []);
        torApp.controller('TORController', function ($scope, $http) {
            $http.get(apiUrl + 'boxes').then(function (data) {
                //$scope.boxes = data.data.slice(0, 8);
                $scope.boxes = data.data;
                $scope.boxes.forEach(b => {
                    b.isSelected = false;
                });
            });

            $scope.selectBox = function (box) {
                if (box.AllowUserMode == 1) {
                    $scope.boxes.forEach(b => {
                        b.isSelected = false;
                    });
                    box.isSelected = true;
                    selectedBox = box;
                    console.log("select box: " + box.Material);
                }
            };

            $scope.switchToUserMode = function () {
                if (!$scope.boxes.some(b => { return b.isSelected; })) {
                    alert('select a box');
                    return;
                }
                selectedBox.UserModeActive = 1;
                $http.put(apiUrl + 'boxes/' + selectedBox.Id, selectedBox);
                $http.get(apiUrl + 'boxes/' + selectedBox.Id).then(function (data) {
                    $scope.activeBox = data.data;
                    $('#boxOverview').fadeOut(1000);
                    isInUserMode = true;
                    $('#moveControls').fadeIn(1000);
                });
            };

            $scope.sendMoveCommand = function(direction) {
                console.log(apiUrl + 'move/' + selectedBox.Id, direction);
                $http.put(apiUrl + 'move/' + selectedBox.Id, {"direction": direction});
            };

            $scope.rollDie = function(dropoffPosition) {
                $http.put(apiUrl + 'roll/' + selectedBox.Id, {"dropoffPosition": dropoffPosition});
            };
        });
    </script>
</head>

<body class="mdc-typography" ng-controller="TORController">
    <div id="boxOverview">
        <div class="mdc-layout-grid">
            <div class="mdc-layout-grid__inner">
                <div class="mdc-layout-grid__cell 
                            mdc-layout-grid__cell--span-2-desktop
                            mdc-layout-grid__cell--span-4-tablet
                            mdc-layout-grid__cell--span-6-phone" ng-repeat="box in boxes" ng-click="selectBox(box)">
                    <div class="mdc-card"
                        ng-class="{'box-available': box.AllowUserMode == 1 && !box.isSelected && !box.UserModeActive == 1, 
                                   'box-disabled': box.AllowUserMode != 1 || box.UserModeActive == 1, 
                                   'box-selected': box.isSelected}">
                        <div class="mdc-card__header">
                            <div>
                                <p class="mdc-card__title">{{box.Material}}</p>
                            </div>
                        </div>
                        <div class="mdc-card__media--square" style="background-image: url('assets/{{box.Material}}.png');"><div style="min-height:200px"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <button class="mdc-fab mdc-fab--extended box-button-start" ng-click="switchToUserMode()">
            <div class="mdc-fab__ripple"></div>
            <span class="mdc-fab__label">Start</span>
        </button>
    </div>
    <div id="moveControls" style="display: none;">
        <button class="mdc-button mdc-button--raised control-button control-button-front"
            ng-click="sendMoveCommand('FRONT')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                arrow_drop_up</i>
        </button>
        <button class="mdc-button mdc-button--raised control-button control-button-left"
            ng-click="sendMoveCommand('LEFT')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                keyboard_arrow_left</i>
        </button>
        <button class="mdc-button mdc-button--raised control-button control-button-right"
            ng-click="sendMoveCommand('RIGHT')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                keyboard_arrow_right</i>
        </button>
        <button class="mdc-button mdc-button--raised control-button control-button-back"
            ng-click="sendMoveCommand('BACK')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                keyboard_arrow_down</i>
        </button>
        <button class="mdc-button mdc-button--raised control-button control-button-up"
            ng-click="sendMoveCommand('UP')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                keyboard_arrow_up</i>
        </button>
        <button class="mdc-button mdc-button--raised control-button control-button-down"
            ng-click="sendMoveCommand('DOWN')">
            <div class="mdc-button__ripple"></div>
            <i class="material-icons mdc-button__icon" aria-hidden="true">
                keyboard_arrow_down</i>
        </button>
    </div>
    <div id="rollControls" style="display: none; max-width: 700px;">
        <div class="mdc-slider" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
            aria-label="Select Value">
            <div class="mdc-slider__track-container">
                <div class="mdc-slider__track"></div>
            </div>
            <div class="mdc-slider__thumb-container">
                <svg class="mdc-slider__thumb" width="21" height="21">
                    <circle cx="10.5" cy="10.5" r="7.875"></circle>
                </svg>
                <div class="mdc-slider__focus-ring"></div>
            </div>
        </div>
        <div class="mdc-slider" tabindex="0" role="slider" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0"
            aria-label="Select Value">
            <div class="mdc-slider__track-container">
                <div class="mdc-slider__track"></div>
            </div>
            <div class="mdc-slider__thumb-container">
                <svg class="mdc-slider__thumb" width="21" height="21">
                    <circle cx="10.5" cy="10.5" r="7.875"></circle>
                </svg>
                <div class="mdc-slider__focus-ring"></div>
            </div>
        </div>
        <button class="mdc-fab mdc-fab--extended button-roll" ng-click="rollDie()">
            <div class="mdc-fab__ripple"></div>
            <span class="mdc-fab__label">Start</span>
        </button>
    </div>
    <script src="https://unpkg.com/material-components-web@latest/dist/material-components-web.min.js"></script>
    <script src="index.js"></script>
    <script type="text/javascript">
        var buttons = document.querySelectorAll('.mdc-button, .mdc-fab');
        for (var i = 0, button; button = buttons[i]; i++) {
            mdc.ripple.MDCRipple.attachTo(button);
        }
        var sliders = document.querySelectorAll('.mdc-slider');
        for (var i = 0, sliders; slider = sliders[i]; i++) {
            mdc.slider.MDCSlider.attachTo(slider);
        }
    </script>
</body>

</html>